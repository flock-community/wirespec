# Spring Integration

This document describes how to integrate Wirespec-generated code with Spring Boot applications.  Wirespec simplifies the creation of type-safe and well-defined APIs, and this integration provides a seamless way to use those APIs within your Spring applications.

The spring integration works on the controller as well as client.

## Setup

Begin with a Spring Boot application. The [Spring Initializr](https://start.spring.io/) is an excellent starting point. Include the `Spring Reactive Web` dependency.

Add the Maven or Gradle Wirespec plugin to your project, as detailed in the [Plugins](/docs/plugins) documentation.  Configure the plugin to use the custom Spring Java or Kotlin emitter.

For Java, use: 

```
community.flock.wirespec.integration.spring.java.emit.SpringJavaEmitter
```

For Kotlin, use:

```
community.flock.wirespec.integration.spring.java.emit.SpringKotlinEmitter
```

## Usage

Enable Spring integration by adding the `@EnableWirespec` annotation to your application's configuration class:


```java
package community.flock.wirespec.examples.maven.spring.integration;

import community.flock.wirespec.integration.spring.java.configuration.EnableWirespec;
import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;

@SpringBootApplication
@EnableWirespec
public class TodoApplication {
    public static void main(String[] args) {
        SpringApplication.run(TodoApplication.class, args);
    }
}

```

Ensure that the import statement corresponds to the correct package:

*   **Java**: `community.flock.wirespec.integration.spring.java`
*   **Kotlin**: `community.flock.wirespec.integration.spring.kotlin`

For finer-grained control, use `@EnableWirespecController` or `@EnableWirespecClient` to enable only the controller or client functionality, respectively.

### Controller

Wirespec endpoints can be seamlessly integrated with Spring controllers, simplifying the exposure of your API while ensuring type safety and clarity.

1. **Annotate with @RestController:** Mark your controller class with the standard @RestController annotation to indicate that it handles incoming web requests.

2. **Implement the Wirespec Handler:** Implement the Wirespec-generated Handler interface for each endpoint you want to expose. This requires providing implementations for the request-handling functions defined in the interface. Each handler function transforms a request into a response.

```java
import community.flock.wirespec.generated.GetTodosEndpoint;
import community.flock.wirespec.generated.CreateTodoEndpoint;

import org.springframework.web.bind.annotation.RestController;

@RestController
class TodoController implements GetTodosEndpoint.Handler, CreateTodoEndpoint.Handler {
    
    @Override
    public CompletableFuture<GetTodosEndpoint.Response<?>> getTodos(GetTodosEndpoint.Request request) {
        // implementation
    }

    @Override
    public CompletableFuture<CreateTodoEndpoint.Response<?>> createTodo(CreateTodoEndpoint.Request request) {
        // implementation
    }
}
```

### Client

This section describes how to utilize the Wirespec-generated client interfaces with Spring's WebClient to perform API calls. The core idea is to implement the Handler interface generated by Wirespec for each endpoint (e.g. GetTodosEndpoint.Handler). This implementation leverages the WirespecWebClient to construct and send requests, and handle responses in a type-safe manner.

1. Create a Spring component (e.g., using @Component) that implements the Handler interface for the specific endpoint you want to use.

2. **Inject the WirespecWebClient Bean:** 

The WirespecWebClient is responsible for interacting with the Spring WebClient. Inject the default WirespecWebClient bean into your component's constructor using Spring's @Autowired annotation. This bean is typically configured and provided by the Wirespec Spring integration.

3. **Implement the Handler Method(s) and Send the Request:**

Implement the handler method(s) defined in the Handler interface (e.g., getTodos in the example). Within the handler method, use the wirespecWebClient.send(request) function to send the request.

The send() method takes the Wirespec-generated Request object as input.

It returns a `CompletableFuture<GetTodosEndpoint.Response<?>>` representing the asynchronous operation. The Response object is also Wirespec-generated and provides type-safe access to the response data. The ? is a wildcard, in this case. Replace it with the actual data type, if known.

```java
package community.flock.wirespec.examples.maven.spring.integration.client;

import community.flock.wirespec.generated.examples.spring.GetTodosEndpoint;
import community.flock.wirespec.integration.spring.java.client.WirespecWebClient;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Component;

import java.util.concurrent.CompletableFuture;

@Component
public class TodoWebClient implements GetTodosEndpoint.Handler {

  private final WirespecWebClient wirespecWebClient;

  @Autowired
  public TodoWebClient(WirespecWebClient wirespecWebClient) {
    this.wirespecWebClient = wirespecWebClient;
  }

  @Override
  public CompletableFuture<GetTodosEndpoint.Response<?>> getTodos(GetTodosEndpoint.Request request) {
    return wirespecWebClient.send(request);
  }
}
```

## Example

Refer to the [maven-spring-integration](https://github.com/flock-community/wirespec/tree/master/examples/maven-spring-integration) example for a complete implementation.




